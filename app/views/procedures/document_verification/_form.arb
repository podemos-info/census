# frozen_string_literal: true

context.instance_eval do
  columns class: "attachments" do
    column do
      render partial: "procedures/document_verification/verificable_data", locals: { procedure: procedure }

      if procedure.dependent_procedures.any?
        panel I18n.t("census.procedures.dependent_procedures") do
          table_for procedure.dependent_procedures, i18n: Procedure do
            column :type, &:type_name
            column :information
          end
        end
      end

      render partial: "procedures/common_form", locals: { context: context, procedure: procedure }
    end
    column do
      procedure.attachments.each do |attachment|
        a href: attachment.view_path do
          if attachment.image?
            img src: attachment.view_path(version: :thumbnail)
          else
            attachment.file.file.original_filename
          end
        end
      end
    end
  end
end
