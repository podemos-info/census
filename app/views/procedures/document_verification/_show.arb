# frozen_string_literal: true

context.instance_eval do
  render partial: "show", locals: { context: context, classes: classes }
  columns class: "attachments" do
    column do
      tabs do
        if procedure.processed?
          tab t("census.procedures.person.when_processed") do
            render partial: "people/show", locals: { context: context, title: "", classes: {}, resource: procedure.processed_person }
          end
        end

        tab t("census.procedures.person.now") do
          render partial: "people/show", locals: { context: context, title: "", classes: person_classes, resource: procedure.person }
        end
      end
    end
    if procedure.attachments.any?
      column do
        procedure.attachments.each do |attachment|
          a href: attachment.view_path do
            if attachment.image?
              img src: attachment.view_path(version: :thumbnail)
            else
              attachment.file.file.original_filename
            end
          end
        end
      end
    end
  end
  if procedure.dependent_procedures.any?
    panel I18n.t("census.procedures.dependent_procedures") do
      table_for procedure.dependent_procedures, i18n: Procedure do
        column :type, &:type_name
        column :information
      end
    end
  end
end